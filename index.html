<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Smart Barcode Scanner</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f9fafb;
      color: #333;
      text-align: center;
    }
    h1 {
      color: #111;
    }
    #scanner-container {
      width: 100%;
      max-width: 600px;
      margin: 20px auto;
      background: #fff;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    #barcode-list {
      margin-top: 20px;
      text-align: left;
    }
    #barcode-list ul {
      list-style: none;
      padding: 0;
    }
    #barcode-list li {
      background: #e0f7fa;
      margin-bottom: 8px;
      padding: 10px;
      border-radius: 5px;
    }
    button {
      margin: 10px 5px;
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>

  <h1>ðŸ“¦ Smart Barcode Scanner</h1>

  <div id="scanner-container"></div>

  <div>
    <button id="switch-camera">Switch Camera</button>
    <button id="clear-scans">Clear Scans</button>
  </div>

  <div id="barcode-list">
    <h2>ðŸ“‹ Scanned Barcodes:</h2>
    <ul id="scanned-items"></ul>
  </div>

  <audio id="beep-sound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>

  <script src="https://unpkg.com/quagga@0.12.1/dist/quagga.min.js"></script>
  <script>
    let isFrontCamera = false; 
    let scanning = true;

    function startScanner() {
      Quagga.init({
        inputStream: {
          name: "Live",
          type: "LiveStream",
          constraints: {
            width: 640,
            height: 480,
            facingMode: isFrontCamera ? "user" : "environment" // Switch camera
          },
          target: document.querySelector('#scanner-container'),
        },
        decoder: {
          readers: ["ean_reader", "upc_reader", "code_128_reader"]
        },
      }, function(err) {
        if (err) {
          console.error(err);
          alert("Error starting scanner.");
          return;
        }
        Quagga.start();
      });

      Quagga.onDetected(handleDetected);
    }

    function stopScanner() {
      Quagga.stop();
      Quagga.offDetected(handleDetected);
    }

    function handleDetected(result) {
      if (!scanning) return;

      const code = result.codeResult.code;
      const scannedList = document.getElementById("scanned-items");
      
      const listItem = document.createElement("li");
      listItem.textContent = code;
      scannedList.appendChild(listItem);

      document.getElementById("beep-sound").play();
      if (navigator.vibrate) {
        navigator.vibrate(200); // Vibrate for 200ms
      }

      scanning = false;
      stopScanner();

      setTimeout(() => {
        if (confirm("Scan again?")) {
          scanning = true;
          startScanner();
        }
      }, 300);
    }

    document.getElementById("switch-camera").addEventListener("click", function() {
      stopScanner();
      isFrontCamera = !isFrontCamera;
      startScanner();
    });

    document.getElementById("clear-scans").addEventListener("click", function() {
      document.getElementById("scanned-items").innerHTML = "";
    });

    window.addEventListener('load', () => {
      startScanner();
    });
  </script>

</body>
</html>
